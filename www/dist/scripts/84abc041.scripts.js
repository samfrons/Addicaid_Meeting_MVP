"use strict";angular.module("addicaidApp",["ajoslin.mobile-navigate","angular-leaflet"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/meetingList",{templateUrl:"views/meetingList.html",controller:"MeetingListCtrl"}).when("/meetingListFavorites",{templateUrl:"views/meetingList.html",controller:"MeetingListFavoritesCtrl"}).when("/map",{templateUrl:"views/map.html",controller:"MapCtrl"}).when("/filter",{templateUrl:"views/filter.html",controller:"FilterCtrl"}).when("/testAllo",{templateUrl:"views/testAllo.html",controller:"TestAlloCtrl"}).when("/rate",{templateUrl:"views/rate.html",controller:"RateCtrl"}).when("/rateReward",{templateUrl:"views/rateReward.html",controller:"RateRewardCtrl"}).when("/meetingList/:meetingID/:showComments",{templateUrl:"views/meetingDetailPage.html",controller:"MeetingDetailPageCtrl"}).when("/meetingDetailPage",{templateUrl:"views/meetingDetailPage.html",controller:"MeetingDetailPageCtrl"}).otherwise({redirectTo:"/login"})}]).run(["$rootScope","$navigate",function(e,t){e.$navigate=t}]).run(["$rootScope",function(e){e.getPartialUrl=function(e){var t="";switch(e){case"header":t="views/header.html";break;case"footer":t="views/footer.html";break;case"meetingDetailSmall":t="views/meetingDetailSmall.html";break;case"testSwitchStatement":t="testUrlHere";break;default:t="views/"+e+".html"}return t},e.safeApply=function(e){var t=this.$root.$$phase;"$apply"===t||"$digest"===t?e&&"function"==typeof e&&e():this.$apply(e)},e.getFellowshipID=function(e){var t="";switch(e){case"AlcoholicsAnonymous":t="AA";break;case"NarcoticsAnonymous":t="NA"}return t},e.parseAddress=function(e,t){var n=e.split("\n")[t-1];return angular.isUndefined(n)&&(n=""),n},e.formatTime=function(e){return angular.isUndefined(e)?"":e},e.formatDay=function(e){return e.substr(0,3)},e.formatDistance=function(e){var t=parseFloat(e),n="1"===t?"MILE":"MILES";return t=isFinite(t)?t+" "+n:null},e.getStarImgSrc=function(e){return e?"images/star_icon_on.png":"images/star_icon.png"},e.toggleFavorite=function(e){e.isFavorite=!e.isFavorite},e.getRatingViewObject=function(e){var t="",n="",i="";switch(e){case"forYoungPeople":t="young_people",n="young_people",i="young people";break;case"isLgbt":t="lgbt",n="lgbt",i="lgbt";break;case"forWomen":t="womens",n="womens",i="womens";break;case"forNewcomer":t="newcomer",n="newcomer",i="newcomer";break;case"outsidersWelcome":t="outsiders",n="outsiders",i="outsiders welcome";break;case"hasWheelchairAccess":t="wheelchair",n="wheelchair",i="wheelchair";break;case"petsAllowed":t="pets",n="pets",i="pets allowed";break;case"isHasSnacks":t="snacks",n="snacks",i="snacks";break;case"isLargeGroup":t="large_group",n="large_group",i="large group";break;case"isHasMeditation":t="meditation",n="meditation",i="meditation";break;case"isForMen":t="mens",n="mens",i="mens";break;case"hasCoffee":t="coffee",n="coffee",i="coffee";break;default:console.log("ERROR: unknown rating ("+e+") in getRatingViewObject")}return{cssClass:t,imgSrc:""===n?"":"images/"+n+".png",displayText:i}}}]),angular.module("addicaidApp").factory("geolocation",["$rootScope","cordovaReady",function(e,t){return{getCurrentPosition:t(function(t,n,i){navigator.geolocation.getCurrentPosition(function(){var n=this,i=arguments;t&&e.$apply(function(){t.apply(n,i)})},function(){var t=this,i=arguments;n&&e.$apply(function(){n.apply(t,i)})},i)})}}]),angular.module("addicaidApp").factory("cordovaReady",[function(){return function(e){var t=[],n=function(){t.push(Array.prototype.slice.call(arguments))};return document.addEventListener("deviceready",function(){t.forEach(function(t){e.apply(this,t)}),n=e},!1),function(){return n.apply(this,arguments)}}}]),angular.module("addicaidApp").controller("MeetingListCtrl",["$scope","$filter","meetingSvc","filterSvc",function(e,t,n,i){e.pageTitle="Meeting List",e.$on(n.meetingsChangedEvent,function(r,a){console.log("MeetingListCtrl#on#meetings changed",r,a),e.meetings=t("andOrFilter")(n.getMeetings("list-on"),i.filtersToApply())}),e.meetings=t("andOrFilter")(n.getMeetings("list"),i.filtersToApply())}]);var defaultCoordinates={latitude:37.771139,longitude:-122.403424};angular.module("addicaidApp").factory("meetingSvc",["$http","$rootScope","filterSvc",function(e,t,n){var i={baseUrl:"http://addicaid.appspot.com/meetings/jsonp",testUrl:"http://addicaid.appspot.com/meetings/jsonp?daylist=MoTu&callback=JSON_CALLBACK",isFilterDirty:!0,waitingForServerResults:!1,meetingsCache:[],meetingsChangedEvent:"meetingsChanged"};i.getCurrentLocation=function(){return{latitude:defaultCoordinates.latitude,longitude:defaultCoordinates.longitude}};var r=function r(e,t){var n="";return n=void 0!==e[t]?e[t]:e.text.replace(" ","_")};return i.getImgSrc=function(e){return"images/"+r(e,"imgFilename")+".png"},i.getCssClass=function(e){return r(e,"cssClass")},i.getMeetingsFromServer=function(){console.log("getMeetingsFromServer"),i.isFilterDirty&&!i.waitingForServerResults&&(i.waitingForServerResults=!0,e.jsonp(i.getUrl()).success(function(e){i.meetingsCache=e.value,angular.forEach(i.meetingsCache,function(e){var t={};angular.forEach(e.rating,function(e,n){e&&(t[n]=e)}),e.rating=t,e.time=e.time.split(":")[0]+":"+e.time.split(":")[1],73021===e.id&&(e.time="19:00",e.timeAsNumber=19)}),i.isFilterDirty=!1,i.waitingForServerResults=!1,console.log("******** got "+i.meetingsCache.length+" meetings **********"),t.$broadcast(i.meetingsChangedEvent,[])}).error(function(e,t){console.log("FAILURE",e,t)}))},i.getQueryStringDays=function(){for(var e="",t=0;n.filters.days.length>t;t++)e+=n.filters.days[t].queryString;return""!==e&&(e="daylist="+e),e},i.getUrl=function(){var e=i.baseUrl;return e+="?",e+=i.getQueryStringDays(),n.filters.location.useCurrentLocation?(e+="&lat="+i.getCurrentLocation().latitude,e+="&long="+i.getCurrentLocation().longitude):n.filters.location.zip&&(e+="&address="+encodeURI(n.filters.location.zip)),e+="&callback=JSON_CALLBACK",console.log("meetingSvc url",e),e},i.getMeetings=function(){return console.log("getMeetings - "+arguments[0]),i.isFilterDirty&&i.getMeetingsFromServer(),i.meetingsCache},i.getMeetingsFavoritesOnly=function(){console.log("getMeetingsFavoritesOnly");for(var e=i.getMeetings("getMeetingsFavoritesOnly"),t=[],n=0;e.length>n;n++)e[n].isFavorite&&t.push(e[n]);return console.log("favorites",t,e),t},i.getMeetingByID=function(e){angular.isString(e)&&(e=parseInt(e,10));for(var t=0;i.getMeetings().length>t;t++)if(i.getMeetings()[t].id===e)return i.getMeetings()[t];return null},i.isMeetingStartingSoon=function(e){var t=4,n=new Date,i=e.time.match(/(\d+)(:)(\d\d)/),r=parseInt(i[1],10),a=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],o=n.getDay()===a.indexOf(e.day)&&r>=n.getHours()&&n.getHours()+t>=r;return o},i.injectFakeLatLng=function(){},i.getMeetingsFromServer(),i}]);var defaultFiltersObject={location:{useCurrentLocation:"true",radius:null,zip:null},fellowships:[{text:"Alcoholics Anonymous",cssClass:"AA",imgSrc:"images/AAcircle.png",filters:[{"fellowship.name":"AlcoholicsAnonymous"}],selected:!1},{text:"Narcotics Anonymous",imgSrc:"images/NAcircle.png",cssClass:"NA",filters:[{"fellowship.name":"NarcoticsAnonymous"}],selected:!1},{text:"SMART Recovery",imgSrc:"images/NAcircle.png",cssClass:"NA",filters:[{"fellowship.name":"SMARTRecovery"}],selected:!1}],days:[{text:"MON",queryString:"Mo",filters:[{day:"MONDAY"}],selected:!1},{text:"TUE",queryString:"Tu",filters:[{day:"TUESDAY"}],selected:!1},{text:"WED",queryString:"We",filters:[{day:"WEDNESDAY"}],selected:!1},{text:"THU",queryString:"Th",filters:[{day:"THURSDAY"}],selected:!1},{text:"FRI",queryString:"Fr",filters:[{day:"FRIDAY"}],selected:!1},{text:"SAT",queryString:"Sa",filters:[{day:"SATURDAY"}],selected:!1},{text:"SUN",queryString:"Su",filters:[{day:"SUNDAY"}],selected:!1}],times:[{text1:"morning",text2:"6AM - 12PM",imgFilename:"clock",filters:[{name:"between",key:"timeAsNumber",start:6,end:12}],selected:!1},{text1:"afternoon",text2:"12PM - 5PM",imgFilename:"clock",filters:[{name:"between",key:"timeAsNumber",start:12,end:17}],selected:!1},{text1:"evening",text2:"5PM - 8PM",imgFilename:"clock",filters:[{name:"between",key:"timeAsNumber",start:17,end:20}],selected:!1},{text1:"night",text2:"8PM...?",imgFilename:"clock",filters:[{name:"between",key:"timeAsNumber",start:20,end:24},{name:"between",key:"timeAsNumber",start:0,end:6}],selected:!1}],ratings:[{text:"young people",filters:[{"rating.forYoungPeople":"true"}],selected:!1},{text:"snacks",filters:[{"rating.isHasSnacks":"true"}],selected:!1},{text:"fellowship",filters:[{"rating.forFellowship":"true"}],selected:!1},{text:"cool venue?",filters:[{"rating.isCoolVenue":"true"}],selected:!1}]};angular.module("addicaidApp").factory("filterSvc",["$filter",function(e){var t={};return t.resetFilters=function(){t.filters=angular.copy(defaultFiltersObject)},t.resetFilters(),t.filtersToApply=function(){var n=[],i=e("selectedFiltersOr")(t.filters.fellowships);angular.isDefined(i)&&n.push(i);var r=e("selectedFiltersOr")(t.filters.days);angular.isDefined(r)&&n.push(r);var a=e("selectedFiltersAnd")(t.filters.ratings);return angular.isDefined(a)&&n.push(a),n},t}]),angular.module("addicaidApp").controller("MapCtrl",["$scope","$filter","meetingSvc","filterSvc",function(e,t,n,i){e.pageTitle="Map",e.currentLatLng=L.latLng(n.getCurrentLocation().latitude,n.getCurrentLocation().longitude),e.mapOptions={center:e.currentLatLng,zoom:13,markers:[L.marker(e.currentLatLng,{icon:L.icon({iconUrl:"images/heremap.png"})})]},e.openPop=function(){console.log("openPop function")};var r=function(t){for(var i=0;t.length>i;i++){var r,a=L.Icon.Default,o=e.getFellowshipID(t[i].fellowship.name);r=n.isMeetingStartingSoon(t[i])?"soon":"map";var l="images/"+o+r+".png";""!==o&&(a=L.icon({iconUrl:l}));var s={icon:a};angular.extend(t[i],{markerOptions:s})}return t};e.markerPopupContentOpts={maxHeight:1e3},e.markerPopupContentFn=function(t){var n='<hgroup class="grids grid-7">    <h3>'+t.title+' <span class="meetinglocation">('+t.latLon.locationName+")</span></h3>"+"    <h4>"+e.parseAddress(t.address,1)+"</h4>"+"    <h4>"+e.parseAddress(t.address,2)+"</h4>"+"</hgroup>"+'<aside class="grids grid-4 right_side map-popup '+e.getFellowshipID(t.fellowship.name)+'">'+'    <div class="timeandday map-popup">'+'        <p class="time">'+e.formatTime(t.time)+"</p>"+'        <p class="day">'+e.formatDay(t.day)+"</p>"+'        <span class="distance">'+e.formatDistance(t.distance)+"</span>"+"    </div>"+"</aside>";return n},e.$on(n.meetingsChangedEvent,function(a,o){console.log("MapCtrl#on#meetings changed",a,o),e.meetings=r(t("andOrFilter")(n.getMeetings("map-on"),i.filtersToApply()))}),e.meetings=r(t("andOrFilter")(n.getMeetings("map"),i.filtersToApply()))}]),angular.module("addicaidApp").controller("FilterCtrl",["$scope","meetingSvc","filterSvc",function(e,t,n){e.pageTitle="Meeting Search",e.getImgSrc=t.getImgSrc,e.getCssClass=t.getCssClass,e.filters=n.filters,e.resetFilters=function(){n.resetFilters(),e.filters=n.filters}}]),angular.module("addicaidApp").controller("LoginCtrl",["$scope",function(e){e.pageTitle="Signup"}]),angular.module("addicaidApp").filter("andOrFilter",["$filter",function(e){return function(t,n){console.log("andOrFilter",n);var i=[];return angular.forEach(t,function(t){var r=!0;angular.forEach(n,function(n){var i=!1;angular.forEach(n,function(n){e("filter")([t],n).length>0&&(i=!0)}),r=r&&i}),r&&i.push(t)}),i}}]),angular.module("addicaidApp").filter("selectedFiltersOr",[function(){return function(e){var t=[];return angular.forEach(e,function(e){e.selected&&angular.forEach(e.filters,function(e){t.push(e)})}),0===t.length&&(t=void 0),t}}]),angular.module("addicaidApp").filter("selectedFiltersAnd",[function(){return function(e){var t={};return angular.forEach(e,function(e){e.selected&&angular.forEach(e.filters,function(e){angular.extend(t,e)})}),t=angular.equals(t,{})?void 0:[t]}}]),angular.module("addicaidApp").directive("ngTap",[function(){var e=!!("ontouchstart"in window);return{restrict:"A",link:function(t,n,i){if(e){var r=!1;n.bind("touchstart",function(){r=!0}),n.bind("touchmove",function(){r=!1}),n.bind("touchend",function(){r&&t.$apply(i.ngTap)})}else n.bind("click",function(){t.$apply(i.ngTap)})}}}]),angular.module("addicaidApp").directive("testDirective",[function(){return{template:"<div></div>",restrict:"E",link:function(e,t){t.text("this is the testDirective directive")}}}]),angular.module("addicaidApp").controller("TestAlloCtrl",["$scope","geolocation",function(e,t){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var n=setInterval(function(){t.getCurrentPosition(function(t){e.position=t,console.log("new pos",t.coords)})},100);e.$on("$destroy",function(){clearInterval(n),console.log("destroy")})}]),angular.module("addicaidApp").controller("TestCtrl",["$scope","$navigate",function(e,t){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.$navigate=t}]),angular.module("addicaidApp").controller("MeetingDetailCtrl",["$scope","meetingSvc",function(e,t){e.getImgSrc=t.getImgSrc,e.getCssClass=t.getCssClass,e.getImgStyle=function(e){var n={"background-image":"url("+t.getImgSrc(e)+")"};return n}}]),angular.module("addicaidApp").controller("MainCtrl",["$scope",function(e){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("addicaidApp").controller("RateCtrl",["$scope",function(e){e.pageTitle="Rate"}]),angular.module("addicaidApp").controller("RateRewardCtrl",["$scope",function(e){e.pageTitle="Rate Reward"}]),angular.module("addicaidApp").controller("MeetingListFavoritesCtrl",["$scope","meetingSvc",function(e,t){e.pageTitle="Favorites",e.$on(t.meetingsChangedEvent,function(n,i){console.log("MeetingListFavoritesCtrl#on#meetings changed",n,i),e.meetings=t.getMeetingsFavoritesOnly()}),e.meetings=t.getMeetingsFavoritesOnly()}]),angular.module("addicaidApp").controller("MeetingDetailPageCtrl",["$scope","$routeParams","meetingSvc",function(e,t,n){e.pageTitle="Meeting Title",e.showComments=t.showComments;var i=function(t){var i,r=L.Icon.Default,a=e.getFellowshipID(t.fellowship.name);i=n.isMeetingStartingSoon(t)?"soon":"map";var o="images/"+a+i+".png";""!==a&&(r=L.icon({iconUrl:o}));var l={icon:r};return angular.extend(t,{markerOptions:l}),t};e.meeting=i(n.getMeetingByID(t.meetingID)),console.log("MeetingDetailPageCtrl",t.meetingID,e.meeting),e.mapOptions={center:L.latLng(e.meeting.latLon.latitude,e.meeting.latLon.longitude),zoom:12},console.log(e.meeting)}]);